<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Договор</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Prata&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/styles.css">
</head>
<body>
  <div class="bg-orb orb-1"></div>
  <div class="bg-orb orb-2"></div>
  <div class="bg-orb orb-3"></div>

  <main class="container" style="padding: 120px 0;">
    <a class="page-back" href="/">← На главную</a>

    <section class="panel">
      <div class="admin-section-head">
        <h1 class="section-title">Договор обучения</h1>
        <div class="admin-section-actions">
          <span class="admin-status {{ contract_status_class }}">{{ contract_status_label }}</span>
        </div>
      </div>
      <ul class="admin-list">
        <li><span>Курс</span><strong>{{ agreement.course or "—" }}</strong></li>
        <li><span>Участник</span><strong>{{ agreement.full_name or agreement.user.name or "—" }}</strong></li>
        <li><span>Канал отправки</span><strong>{{ contract_channel_label }}</strong></li>
      </ul>
      {% if contract_url %}
      <div style="margin-top: 14px;">
        <a class="btn btn-secondary" href="{{ contract_url }}" target="_blank" rel="noopener">Открыть ссылку</a>
      </div>
      {% endif %}
    </section>

    {% if message %}
    <section class="card" style="margin-top: 18px;">
      <strong>{{ message }}</strong>
    </section>
    {% endif %}
    {% if error %}
    <section class="card" style="margin-top: 18px; border-color: rgba(255, 77, 77, 0.4);">
      <strong>{{ error }}</strong>
    </section>
    {% endif %}

    <section class="panel" style="margin-top: 24px;">
      <div class="admin-section-head">
        <h2 class="section-title">Ключевые пункты</h2>
      </div>
      <ul class="admin-list">
        {% for point in contract_key_points %}
        <li><span>{{ point }}</span></li>
        {% endfor %}
      </ul>
      {% if contract_documents %}
      <div style="height: 12px;"></div>
      <div class="course-meta">Документы</div>
      <ul class="admin-list">
        {% for title, doc in contract_documents %}
        <li>
          <span>{{ title }}</span>
          <a class="admin-copy" href="{{ doc }}" target="_blank" rel="noopener">Открыть</a>
        </li>
        {% endfor %}
      </ul>
      {% endif %}
    </section>

    <section class="panel" style="margin-top: 24px;">
      <div class="admin-section-head">
        <h2 class="section-title">Отправить договор</h2>
      </div>
      <form class="admin-filter" method="post" action="/contract/{{ agreement.contract_token }}/send">
        <div class="admin-filter__row">
          <div class="input-wrap">
            <label class="auth-label">Канал</label>
            <select name="channel">
              {% for item in channels %}
              <option value="{{ item.key }}" {% if item.key == default_channel %}selected{% endif %} {% if item.disabled %}disabled{% endif %}>
                {{ item.label }}{% if item.detail %} · {{ item.detail }}{% endif %}{% if item.note %} ({{ item.note }}){% endif %}
              </option>
              {% endfor %}
            </select>
          </div>
          <div class="input-wrap">
            <label class="auth-label">Email для отправки</label>
            <input type="email" name="email" placeholder="name@example.com" value="{{ manual_email }}">
          </div>
        </div>
        <div class="admin-filter__actions">
          <button class="btn btn-primary" type="submit">Отправить договор</button>
        </div>
      </form>
      <div class="admin-subtext" style="margin-top: 8px;">
        Если отправка в VK недоступна, укажите email вручную.
      </div>
    </section>

    {% if contract_status_key != "signed" %}
    <section class="panel" style="margin-top: 24px;">
      <div class="admin-section-head">
        <h2 class="section-title">Подтверждение</h2>
      </div>
      <form method="post" action="/contract/{{ agreement.contract_token }}/sign">
        <button class="btn btn-secondary" type="submit">Подтвердить ознакомление с договором</button>
      </form>
    </section>
    {% endif %}
  </main>
</body>
</html>
